<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SM SMART TUITION | Full Pro</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶∏‡¶¨ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ï‡¶Æ‡ßç‡¶¨‡¶ø‡¶®‡ßá‡¶∂‡¶® ‡¶ì ‡¶•‡¶ø‡¶Æ */
        :root { --p: #0f172a; --acc: #0ea5e9; --bg: #020617; --white: #f8fafc; --grad: linear-gradient(135deg, #0ea5e9, #6366f1); }
        [theme="ocean"] { --p: #1e3a8a; --acc: #3b82f6; --bg: #f0f9ff; --white: #1e293b; --grad: linear-gradient(135deg, #3b82f6, #2dd4bf); }
        [theme="forest"] { --p: #064e3b; --acc: #10b981; --bg: #ecfdf5; --white: #064e3b; --grad: linear-gradient(135deg, #10b981, #34d399); }

        body { font-family: 'Poppins', 'Hind Siliguri', sans-serif; background: var(--bg); color: var(--white); margin: 0; }
        .header { padding: 15px; text-align: center; background: var(--p); border-bottom: 2px solid var(--acc); display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index:100; }
        
        .card { background: rgba(255,255,255,0.06); padding: 12px; border-radius: 15px; margin: 10px; display: flex; align-items: center; gap: 10px; border: 1px solid rgba(128,128,128,0.2); }
        .card img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--acc); object-fit: cover; }
        .btn { border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; font-size: 11px; }
        .btn-grad { background: var(--grad); }
        
        #id-card-view { width: 320px; background: white; color: black; border-radius: 10px; padding: 15px; margin: auto; position: relative; border: 2px solid var(--acc); }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; overflow-y: auto; padding: 20px; }
        .sidebar { position: fixed; left: -260px; top: 0; width: 250px; height: 100%; background: var(--p); z-index: 1100; transition: 0.3s; padding: 20px; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }
        .sidebar.active { left: 0; }
    </style>
</head>
<body id="main-body">

    <div class="header">
        <div onclick="toggleSidebar()" style="font-size:24px; cursor:pointer; color:var(--acc)">‚ò∞</div>
        <h3 style="margin:0; font-family: 'Orbitron'; color:var(--acc)">SM SMART PRO</h3>
        <div style="width:24px"></div>
    </div>

    <div class="sidebar" id="sidebar">
        <h3 style="color:var(--acc)">MENU & THEMES</h3>
        <button onclick="setTheme('dark')" class="btn" style="width:100%; margin-bottom:10px; background:#0f172a">Dark Default</button>
        <button onclick="setTheme('ocean')" class="btn" style="width:100%; margin-bottom:10px; background:#1e3a8a">Ocean Blue</button>
        <button onclick="setTheme('forest')" class="btn" style="width:100%; margin-bottom:10px; background:#064e3b">Forest Green</button>
        <hr style="opacity:0.2">
        <button onclick="toggleSidebar()" class="btn" style="width:100%; background:#555">CLOSE</button>
    </div>

    <div style="padding: 15px;">
        <button onclick="openModal('add-modal')" class="btn btn-grad" style="width:100%; padding:15px; margin-bottom:15px; font-size:16px">+ NEW REGISTRATION</button>
        <input type="text" id="search" placeholder="Search student..." onkeyup="render()" style="width:92%; padding:12px; border-radius:10px; background:rgba(255,255,255,0.1); border:1px solid var(--acc); color:white; margin-bottom:15px;">
        <div id="list">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    </div>

    <div id="id-modal" class="modal">
        <div style="text-align:center">
            <div id="id-card-view">
                <h4 style="margin:0; color:var(--acc)">SM TUITION CENTER</h4>
                <hr>
                <img id="id-img" src="" style="width:80px; height:80px; border-radius:5px; margin:10px 0; border:1px solid #ddd">
                <div style="text-align:left; font-size:12px; padding-left:20px">
                    <b>NAME:</b> <span id="id-name"></span><br>
                    <b>CLASS:</b> <span id="id-cls"></span><br>
                    <b>ID NO:</b> <span id="id-val"></span>
                </div>
                <div id="id-qr" style="margin-top:10px; display:flex; justify-content:center"></div>
            </div>
            <br>
            <button onclick="downloadCard()" class="btn btn-grad" style="padding:12px 25px">DOWNLOAD CARD</button>
            <button onclick="closeModal('id-modal')" class="btn" style="background:#555; margin-left:10px">CLOSE</button>
        </div>
    </div>

    <div id="add-modal" class="modal">
        <div style="background:var(--p); padding:20px; border-radius:20px; border:1px solid var(--acc); max-width:400px; margin:auto;">
            <h3 style="color:var(--acc)">NEW STUDENT</h3>
            <input type="file" id="a-photo" style="margin-bottom:10px" accept="image/*">
            <input type="text" id="a-name" placeholder="Name" style="width:94%; padding:10px; margin-bottom:10px; border-radius:5px">
            <input type="text" id="a-cls" placeholder="Class" style="width:94%; padding:10px; margin-bottom:10px; border-radius:5px">
            <button onclick="saveStudent()" class="btn btn-grad" style="width:100%; padding:12px">SAVE TO CLOUD</button>
            <button onclick="closeModal('add-modal')" class="btn" style="width:100%; margin-top:10px; background:#555">CANCEL</button>
        </div>
    </div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyAq1HPtvPEXTZ5LTh8m12_9sjCcucFSLvw",
        authDomain: "smart-tution-f92ea.firebaseapp.com",
        databaseURL: "https://smart-tution-f92ea-default-rtdb.firebaseio.com/",
        projectId: "smart-tution-f92ea",
        storageBucket: "smart-tution-f92ea.appspot.com",
        messagingSenderId: "916106918765",
        appId: "1:916106918765:web:47c575e0f8446934b7b864"
    };

    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database().ref("students");
    let students = [];

    // Real-time Sync
    dbRef.on('value', (snapshot) => {
        students = [];
        snapshot.forEach((child) => { students.push({ f_id: child.key, ...child.val() }); });
        render();
    });

    function render() {
        const list = document.getElementById('list');
        const query = document.getElementById('search').value.toLowerCase();
        list.innerHTML = "";
        students.forEach((s) => {
            if (s.name.toLowerCase().includes(query)) {
                list.innerHTML += `
                <div class="card">
                    <img src="${s.photo || 'https://via.placeholder.com/50'}">
                    <div style="flex:1"><b>${s.name}</b><br><small>ID: ${s.id} | Class: ${s.cls}</small></div>
                    <button onclick="showID('${s.f_id}')" class="btn btn-grad">ID CARD</button>
                    <button onclick="deleteStudent('${s.f_id}')" class="btn" style="background:#ff4444; margin-left:5px">üóë</button>
                </div>`;
            }
        });
    }

    async function saveStudent() {
        const name = document.getElementById('a-name').value;
        const cls = document.getElementById('a-cls').value;
        const photoFile = document.getElementById('a-photo').files[0];
        const id = "SM" + Math.floor(1000 + Math.random() * 9000);
        let photo = "";
        if(photoFile) photo = await compressImg(photoFile);

        if(name && cls) {
            dbRef.push({ id, name, cls, photo, date: new Date().toLocaleDateString() })
            .then(() => { closeModal('add-modal'); alert("Saved Successfully!"); });
        }
    }

    function showID(fid) {
        const s = students.find(x => x.f_id === fid);
        document.getElementById('id-name').innerText = s.name;
        document.getElementById('id-cls').innerText = s.cls;
        document.getElementById('id-val').innerText = s.id;
        document.getElementById('id-img').src = s.photo || 'https://via.placeholder.com/50';
        document.getElementById('id-qr').innerHTML = "";
        new QRCode(document.getElementById('id-qr'), { text: "https://subratamahato-web.github.io/Smart-Tution-/?id=" + s.id, width: 60, height: 60 });
        openModal('id-modal');
    }

    function downloadCard() {
        html2canvas(document.getElementById('id-card-view')).then(canvas => {
            let link = document.createElement('a');
            link.download = 'ID_Card.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function deleteStudent(id) { if(confirm("Delete this student?")) dbRef.child(id).remove(); }
    function compressImg(file) {
        return new Promise(res => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = e => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 150; canvas.height = 150;
                    canvas.getContext('2d').drawImage(img, 0, 0, 150, 150);
                    res(canvas.toDataURL('image/jpeg', 0.7));
                };
            };
        });
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
    function setTheme(t) { document.documentElement.setAttribute('theme', t); toggleSidebar(); }
    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
</script>
</body>
</html>
